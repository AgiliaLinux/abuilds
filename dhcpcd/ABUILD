# ABUILD generated by mkpkg_generator.sh

pkgname=dhcpcd
pkgver=6.0.5
pkgbuild=1
arch=("auto")

shortdesc=("DHCP client daemon")

tags=("network net-misc")

source=("http://roy.marples.name/downloads/dhcpcd/dhcpcd-${pkgver}.tar.bz2")
config_files="etc/dhcpcd.conf
etc/conf.d/dhcpcd"
build_deps="glibc-solibs"

BUILD_SYSTEM="autotools"
BUILD_KEYS="--libexecdir=/usr/libexec \
--dbdir=/var/lib/dhcpcd \
--libdir=/usr/lib$LIBDIRSUFFIX \
--mandir=/usr/man"

INSTALL_KEYS="DESTDIR=$pkgdir"

after_build() {
	set -e
	mkdir -p ${pkgdir}/usr/sbin
	( cd ${pkgdir}/usr/sbin ; ln -s ../../sbin/dhcpcd dhcpcd ) 

	#Patch config for MS static routes on default
	sed -i 's/option classless_static_routes/# Obtain from server and write in routing table MS classless static routes.\
	option ms_classless_static_routes/' ${pkgdir}/etc/dhcpcd.conf
	# Disable IPV4LL
	echo noipv4ll >> ${pkgdir}/etc/dhcpcd.conf # Disable ip4vall

	# Copy OpenRC scripts
	mkdir -p ${pkgdir}/etc/{conf.d,init.d}
	install -m0755 ${filedir}/dhcpcd.initd ${pkgdir}/etc/init.d/dhcpcd
	install -m0644 ${filedir}/dhcpcd.confd ${pkgdir}/etc/conf.d/dhcpcd
	set +e

}
