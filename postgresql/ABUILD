# ABUILD generated by mkpkg_generator.sh

pkgname=postgresql
pkgver=9.2.4
pkgbuild=1
arch=("auto")

shortdesc=("PostgreSQL (Relational database server)")
longdesc=("PostgreSQL is an advanced Object-Relational database management system (DBMS) that supports almost all SQL constructs (including transactions, subselects and user-defined types and functions). The homepage for PostgreSQL is http://www.postgresql.org/")

tags=("server dev-db")

source=("ftp://ftp.postgresql.org/pub/source/v${pkgver}/postgresql-${pkgver}.tar.bz2")
build_deps=("krb5 libxml2 python perl tcl openssl openldap linux-pam libxslt")

config_files="etc/logrotate.d/postgresql
etc/conf.d/postgresql"

BUILD_SYSTEM="autotools"
BUILD_KEYS="--prefix=/usr \
--libdir=/usr/lib${LIBDIRSUFFIX} \
--sysconfdir=/etc \
--mandir=/usr/man \
--docdir=/usr/doc/${pkgname}-${pkgver}/ \
--with-tcl \
--with-perl \
--with-python \
--with-ldap \
--with-openssl \
--with-krb5 \
--with-pam \
--with-libxml \
--with-libxslt \
--with-system-tzdata=/usr/share/zoneinfo \
--enable-thread-safety \
--enable-nls"

INSTALL_KEYS="DESTDIR=$pkgdir"


after_build() {
	go_src_dir
	set -e
	cd contrib
		make -j${numjobs} || exit 1
		make install DESTDIR=${pkgdir}
	cd ..

	mkdir -p ${pkgdir}/var/log/pgsql
	touch ${pkgdir}/var/log/pgsql/serverlog.new
	install -D -m0644 $filedir/postgresql.logrotate ${pkgdir}/etc/logrotate.d/postgresql

	install -Dm0755 ${filedir}/postgresql.init ${pkgdir}/etc/init.d/postgresql
	install -Dm0755 ${filedir}/postgresql.conf.d ${pkgdir}/etc/conf.d/postgresql

	mkdir -p ${pkgdir}/var/lib/pgsql
	chown -R pgsql:pgsql ${pkgdir}/var/log/pgsql
	chown pgsql:pgsql ${pkgdir}/var/lib/pgsql
	set +e
}

