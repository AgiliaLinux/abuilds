# ABUILD generated by mkpkg_generator.sh

pkgname=cyrus-sasl
pkgver=2.1.23
pkgbuild=8
arch=('auto')

shortdesc=('cyrus-sasl (Simple Authentication and Security Layer)')
longdesc=('This is the Cyrus SASL library. Cyrus SASL is used by mail programs on the client or server side to provide authentication and authorization services. See RFC 2222 for more information.')

tags=('dev-libs network')

source=("ftp://ftp.cyrusimap.org/cyrus-sasl/cyrus-sasl-${pkgver}.tar.gz")
config_files="etc/conf.d/saslauthd"

build_deps='openssl-solibs glibc-solibs'


BUILD_SYSTEM='autotools'
BUILD_KEYS="--prefix=/usr \
	--libdir=/usr/lib${LIBDIRSUFFIX} \
	--with-plugindir=/usr/lib${LIBDIRSUFFIX}/sasl2 \
	--with-configdir=/etc/sasl2 \
	--sysconfdir=/etc \
	--localstatedir=/var \
	--disable-static \
	--enable-login \
	--with-pam \
	--disable-anon \
	--without-ldap \
	--with-saslauthd \
	--with-gdbm \
	--with-dblib=gdbm"
MAKE_KEYS="sasldir=/usr/lib${LIBDIRSUFFIX}/sasl2"
INSTALL_KEYS="sasldir=/usr/lib${LIBDIRSUFFIX}/sasl2 install DESTDIR=$pkgdir"

after_build() {
	mkdir -p $pkgdir/var/state/saslauthd

	# Fix sloppy man page installation:
	rm -rf $pkgdir/usr/man/cat8
	cat saslauthd/saslauthd.mdoc > $pkgdir/usr/man/man8/saslauthd.8
	find $pkgdir/usr/doc/cyrus-sasl-$pkgver -type f -exec chmod 644 {} \;
	rm -f $pkgdir/usr/doc/cyrus-sasl-$pkgver/doc/*Makefile*

	# Add OpenRC scripts
	install -Dm0644 $filedir/conf.d/saslauthd $pkgdir/etc/conf.d/saslauthd
	install -Dm0755 $filedir/init.d/saslauthd $pkgdir/etc/init.d/saslauthd

}
