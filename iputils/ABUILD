# ABUILD generated by mkpkg_generator.sh

pkgname=iputils
pkgver=s20121011
pkgbuild=1
arch=("auto")

shortdesc=("A collection of common network tools")
longdesc=("The iputils package contains network tools found on nearly all *NIX systems, along with an extra or two. Some of the utilities found here include arping, clockdiff, ping, ping6, rarpd, rdisc, tracepath, tracepath6, and traceroute6. iputils is maintained by YOSHIFUJI Hideaki.")

tags=("network net-misc")

source=("http://www.skbuff.net/iputils/iputils-${pkgver}.tar.bz2")

build_deps="libcap openssl sysfsutils opensp perl-sgmls"


build() {
	go_src_dir
	burn_patches
	sed -i -e "/^CCOPT=/s|-O2|${CFLAGS}|" Makefile
	make -j${numjobs}

	( cd doc
		for file in *.sgml; do
			xf=${file/.sgml/.xml}
			osx -xlower -xno-nl-in-tag $file > $xf || true
			sed -i "s|<refname>\(.*\), \(.*\)</refname>|<refname>\1</refname>, <refname>\2</refname>|g" $xf
			#docbook2man $xf
		done
		make man
	)

	install -dm755 ${pkgdir}/usr/{bin,sbin} ${pkgdir}/bin

	install -m755 arping clockdiff rarpd rdisc tftpd tracepath tracepath6 ${pkgdir}/usr/sbin/

	install -m755 ping{,6} ${pkgdir}/usr/bin/
	ln -sf ../usr/bin/ping{,6}  ${pkgdir}/bin/

	install -dm755 ${pkgdir}/usr/man/man8
	install -m644 doc/{arping,clockdiff,ping,rarpd,rdisc,tftpd,tracepath}.8 ${pkgdir}/usr/man/man8/

	cd ${pkgdir}/usr/man/man8
	ln -sf ping.8.gz  ping6.8.gz
	ln -sf tracepath.8.gz tracepath6.8.gz
}

